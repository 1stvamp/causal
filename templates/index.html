<!DOCTYPE html "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Google Maps JavaScript API Example</title>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=abcdefg&sensor=true_or_false"
            type="text/javascript"></script>
    <script src="http://www.google.com/jsapi?key=ABQIAAAAoahm4X2ZZbu2vafcGW8FBhQfPw8k5w1XjlHSohpuS1o_xI9BChSUSYi-6vw3M9AFV7f1XlMYMdfmDw" type="text/javascript"></script>
    <script type="text/javascript">

    google.load("jquery", "1.4.2");

    var map;
    function initialize() {
      if (GBrowserIsCompatible()) {
        map = new GMap2(document.getElementById("map_canvas"));
	 coder = new GClientGeocoder();
	 coder.setBaseCountryCode("GR");
	 {% if readings %}
	 {% for reading in readings %}
	 var home{{reading.user.user_id}} = coder.getLatLng("{{reading.postcode}}", callbackGet);
	 {% endfor %}
	 {% else %}
	 city = new GClientGeocoder();
		city.setBaseCountryCode("GR");
		city.getLatLng("Beverley, uk", callbackGet);
	 {% endif %}
        //map.setCenter(new GLatLng(37.4419, -122.1419), 13);
	 //var marker{{event.id}} = new GMarker(new GLatLng({{event.lat}},{{event.long}}));
        map.setUIToDefault();
	GEvent.addListener(map,"click", function(overlay, latlng) {
  if (latlng) {
    //var myHtml = "The GPoint value is: " + latlng + " at zoom level " + map.getZoom();
    //map.openInfoWindow(latlng, myHtml);
    var pc = document.getElementById('postcode');
    pc.value = latlng;
  }
});

      }
    }

    function callbackGet(home){
      map.setCenter(home,13);

      marker = new GMarker(home);
      GEvent.addListener(marker, "click", function() {
        marker.openInfoWindowHtml("<b>We are here</b>");
      });
      map.addOverlay(marker);
      map.addControl(new GLargeMapControl());
      map.addControl(new GMapTypeControl());
    }

    </script>
  </head>
  <body onload="initialize()" onunload="GUnload()">
    <a href="/login"> login </a>
    <a href="/logout"> logout </a>
    {{ user.nickname }}
    <div id="map_canvas" style="width: 500px; height: 300px"></div>
    <div>
      <form id="details" action="/" method="post">
      <ul>
        <li>
        <label for="postcode">Postcode</label>
	<input type="text" size="20" id="postcode" name="postcode"/>
	</li>
	<li>
	<label for="gas">Gas</label>
	<input type="text" size="20" id="gas" name="gas"/>
	</li>
	<li>
	<label for="electric">Electric</label>
	<input type="text" size="20" id="electric" name="electric"/>
	</li>
	<li>
	<input type="submit" value="Submit"/>
	</li>
	</ul>
      </form>
    </div>
  </body>
</html>