{% extends "causal/base.html" %}
{% load extras %}
{% block head %}
    <script src="/static/js/iphone-style-checkboxes.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/static/css/iphone-style-checkboxes.css" type="text/css" media="screen" />
    <script>
        //<![CDATA[
        $(function() {
            $('.share_control').iphoneStyle({
                checkedLabel: 'Shared',
                uncheckedLabel: 'Private'
            });
            $('.share_control').parent('div').addClass('share_wrapper');
            $('.share_control').change(function() {
                $.post(
                    '{% url share-prefs %}',
                    $('form#share-prefs-form').serialize(),
                    function(data) {
                        console.log(data);
                    }
                );
                return false;
            });
        });
        //]>
	function _ajax_request(url, data, callback, type, method) {
	    if (jQuery.isFunction(data)) {
		callback = data;
		data = {};
	    }
	    return jQuery.ajax({
		type: method,
		url: url,
		data: data,
		success: callback,
		dataType: type
		});
	}

	jQuery.extend({
	    put: function(url, data, callback, type) {
		return _ajax_request(url, data, callback, type, 'PUT');
	    },
	    delete_: function(url, data, callback, type) {
		return _ajax_request(url, data, callback, type, 'DELETE');
	    }
	});
	function reloadPage() {location.reload(true);}
        $(document).ready(function() {
    	    $(function() {
	        $( ".delete_button" ).button();
	        $( "button", ".delete_button" ).click(function() { 
		    $.delete_('http://localhost:8080/bassdread/service/6.json', {}, reloadPage);
		});
	    });
        }); 	

    </script>
    
{% endblock head %}

{% block primary %}
    <div class="form-data">
        <div>
            <form id="user-profile-form" method="post" action=".">
                {% csrf_token %}
                {{ form.as_p }}
                <p>
                    <input type="submit" value="Save" />
                </p>
            </form>
        </div>
        {% if enabled_services %}
                <h3>Enabled services:</h3>
                <ul>
                    {% for service in enabled_services %}
                        <li>{% if service.setup %}
                                {% include service.form_template_path %}
                                <input type="checkbox" id="service_{{ service.pk }}" name="service_{{ service.pk }}" class="share_control" {% if service.share %}checked="checked"{% endif %}/>
                                
                                <div class="delete_button">
				<button>{{service.app.module_name}}</button>
				</div>
                                
                                {% if not forloop.last %}
                                    <hr/>
                                {% endif %}
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
        {% endif %}
        {% if available_services_unconfigured %}
        <h3>Unconfigured services:</h3>
        <ul>
        {% for service in available_services_unconfigured %}
            <li>
            {% if service %} 
                {% include service.form_template_path %}
                {% if not forloop.last %}<hr/>{% endif %}
            {% endif %}
            </li>
        {% endfor %}
        </ul>
        {% endif %}
        {% if available_services %}
            <h3>Available services:</h3>
            <ul>
                {% for service in available_services %}
                    <li><a href="{% url enable-service service.id %}">{{ service.module.DISPLAY_NAME }}</a></li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
{% endblock primary %}
